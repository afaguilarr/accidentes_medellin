knitr::opts_chunk$set(echo = TRUE)
##Carga de paquetes previos
library(tidyverse)
##Lectura de las 5 bases de datos desde el drectorio
getwd() #CHECKEAR QUE EL DIRECTORIO SEA: "/accidentes_medellin/Descriptiva y depuracion"
files_names= list.files(pattern="*.csv", path =  paste(getwd(),"/Datasets",sep=""))
path <- paste(getwd(),"/Datasets/",files_names,sep="")
df <- do.call(rbind, lapply(path, function(x) read.csv(x, stringsAsFactors = FALSE,encoding = 'UTF-8', ) )) ##se leen y se juntas las 5 bases de datos usando los nombres de los archivos.
setwd(dirname(rstudioapi::getActiveDocumentContext()$path))
pkg_test_and_load <- function(pkg)
{
if(pkg %in% rownames(installed.packages()))
{
library(pkg, character.only = TRUE)
}
else
{
install.packages(pkg, dependencies = TRUE)
library(pkg, character.only = TRUE)
}
}
init_pkgs <- function()
{
pkgs <- c("mvtnorm", "ggplot2", "MBESS", "Matrix", "ks",
"caret", "rgdal", "leaflet", "knitr","rmarkdown",
"PKI", "packrat", "raster", "tidyverse")
lapply(pkgs, pkg_test_and_load)
}
init_pkgs()
init_map <- function(data_location, colores=NA)
{
barrios_med <- shapefile(data_location, encoding="UTF-8",use_iconv=TRUE)
nombres_barrios=iconv(barrios_med@data$NOMBRE,"UTF-8","ISO_8859-1")
m<-leaflet(barrios_med)
m<-addProviderTiles(m,provider="OpenStreetMap.Mapnik")
m<-addPolygons(m,popup=barrios_med@data$NOMBRE,weight = 1)
if(is.na(colores))
{
#colores<-sample(x=c("orange","green","yellow"),
#                size=length(barrios_med@data$NOMBRE),replace=TRUE)
m<-addPolygons(m,popup=barrios_med@data$NOMBRE,color=colores,weight = 1)
print(m)
}
}
init_map <- function(data_location, colores=NA)
{
barrios_med <- shapefile(data_location, encoding="UTF-8",use_iconv=TRUE)
nombres_barrios=iconv(barrios_med@data$NOMBRE,"UTF-8","ISO_8859-1")
m<-leaflet(barrios_med)
m<-addProviderTiles(m,provider="OpenStreetMap.Mapnik")
m<-addPolygons(m,popup=barrios_med@data$NOMBRE,weight = 1)
if(is.na(colores))
{
#colores<-sample(x=c("orange","green","yellow"),
#                size=length(barrios_med@data$NOMBRE),replace=TRUE)
m<-addPolygons(m,popup=barrios_med@data$NOMBRE,color=colores,weight = 1)
print(m)
}
}
init_map()
source("maps_scripts.R")
medellin_map_location <- "./Datasets/Barrio_Vereda/Barrio_Vereda.shp"
df_coloring <- read.csv("./Datasets/df_coloring.csv")
barrios_med <- shapefile(medellin_map_location, encoding="UTF-8",use_iconv=TRUE)
nombres_barrios=iconv(barrios_med@data$NOMBRE,"UTF-8","ISO_8859-1")
m1<-leaflet(barrios_med)
m1<-addProviderTiles(m,provider="OpenStreetMap.Mapnik")
m1<-addPolygons(m,popup=barrios_med@data$NOMBRE,weight = 1)
m1<-leaflet(barrios_med)
m1<-addProviderTiles(m1,provider="OpenStreetMap.Mapnik")
m1<-addPolygons(m1,popup=barrios_med@data$NOMBRE,weight = 1)
init_map()
m1
b <- barrios_med@data$NOMBRE
matched <- intersect(b, df_coloring$BARRIO)
all <-  union(b, df_coloring$BARRIO)
non.matched <- as.matrix(all[!all %in% matched])
v <- df_coloring[!df_coloring$BARRIO %in% intersect(b, df_coloring$BARRIO),]$BARRIO
v <- as.matrix(v)
matched <- intersect(b, df_coloring$BARRIO)
all <-  union(b, df_coloring$BARRIO)
non.matched <- as.matrix(all[!all %in% matched])
v <- df_coloring[!df_coloring$BARRIO %in% intersect(b, df_coloring$BARRIO),]$BARRIO
v <- as.matrix(v)
v2 <- b[!b %in% intersect(b, df_coloring$BARRIO)]
v2 <- as.matrix(v2)
common <- intersect(v, v2)
l_colors <- c("purple", "green", "yellow", "red", "blue", "gray", "black")
barrios_med <- barrios_med[barrios_med@data$NOMBRE %in% df_coloring$BARRIO,]
barrios_med <- barrios_med[barrios_med@data$SUBTIPO_BA == "1",]
df_coloring <- df_coloring[order(barrios_med@data$NOMBRE),]
colnames(df_coloring)[1] <- "NOMBRE"
barrios_med@data <- merge(barrios_med@data, df_coloring[, -2:-8], by = 'NOMBRE')
for(i in 1:max(barrios_med@data$C3G))
{
barrios_med@data$C3G <- ifelse(barrios_med@data$C3G == i,
l_colors[i], barrios_med@data$C3G)
}
for(i in 1:max(barrios_med@data$C4G))
{
barrios_med@data$C4G <- ifelse(barrios_med@data$C4G == i,
l_colors[i], barrios_med@data$C4G)
}
for(i in 1:max(barrios_med@data$C5G))
{
barrios_med@data$C5G <- ifelse(barrios_med@data$C5G == i,
l_colors[i], barrios_med@data$C5G)
}
for(i in 1:max(barrios_med@data$C6G))
{
barrios_med@data$C6G <- ifelse(barrios_med@data$C6G == i,
l_colors[i], barrios_med@data$C6G)
}
for(i in 1:max(barrios_med@data$C7G))
{
barrios_med@data$C7G <- ifelse(barrios_med@data$C7G == i,
l_colors[i], barrios_med@data$C7G)
}
m<-leaflet(barrios_med)
m<-addProviderTiles(m,provider="OpenStreetMap.Mapnik")
m<-addPolygons(m,popup=barrios_med@data$NOMBRE,weight = 1)
colores <- barrios_med@data$C4G
m<-addPolygons(m,popup=barrios_med@data$NOMBRE, color = "black", fillColor=colores,weight = 2, fillOpacity = 0.4)
m
m<-addProviderTiles(m,provider="OpenStreetMap.Mapnik")
m <- 1
m<-leaflet(barrios_med)
m<-addProviderTiles(m,provider="OpenStreetMap.Mapnik")
m<-addPolygons(m,popup=barrios_med@data$NOMBRE,weight = 1)
m
